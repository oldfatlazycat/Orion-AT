; Test program for Z280 CPU (C)Eugene Po - efu@mail.ru (http://orion.efu.name) 24.12.2023
;=============================================================================
CNTLA0	equ	00h		; ASCI Control Register A 0
CNTLB0	equ	02h		; ASCI Control Register B 0
;=============================================================================
org (0000)
START:
  di				; откл. прерывани€
  xor a				; обнулить аккумул€тор
  out0 (36h),a		; откл. регенерацию пам€ти
;=============================================================================
; настройка Serial Port 0
;=============================================================================
  ld a,01110100b	; прием и передача вкл. RTS=1,8,N,1
  out0 (CNTLA0),a	; Init CNTLA0 (COM1)
  ld a,10110000b	; PS=30, DR=16, SS=1, 9600BPS дл€ PHI=18,432/4/2 м√ц = 2.304 ћ√ц
  out0 (CNTLB0),a	; Init CNTLB0 (COM1)
;=============================================================================
  ld	hl,MSG_Hello_World
out_str1:
  ld	a,(hl)
  cp	0				; пока не встретитс€ символ "00"
  jr	z,TestEnd
  ld	c,a
test_sym1:
  in0	a,(04h)			; читать статус порта COM1 (STAT0)
  rra
  rra					; провер€ем бит 1
  jr	nc,test_sym1	; если буфер не пустой - байт не передан (флаг C=0), оп€ть проверить
  out0	(06h),c			; отправить в COM1
  inc	hl				; следующий символ
  jr	out_str1
  
TestEnd:
  halt
;=============================================================================
MSG_Hello_World:
  .db "Hello, World! I'm processor "Zilog Z280!"", 0dh, 0ah, 0
end